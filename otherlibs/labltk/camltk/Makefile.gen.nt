!include ..\support\Makefile.common.nt

all: cTk.ml camltk.ml .depend

tkgen.ml: ..\Widgets.src ..\compiler\tkcompiler
	cd .. & ..\..\boot\ocamlrun compiler/tkcompiler -camltk -outdir labltk

# dependencies are broken: wouldn't work with gmake 3.77

cTk.ml camltk.ml .depend: _tkgen.ml ..\builtin\report.ml ..\compiler\pp #../builtin/builtin_*.ml
	type << > _cTk.ml
##define CAMLTK
include Camltkwrap
open Widget
open Protocol
open Textvariable
<<
	type ..\builtin\report.ml >> _cTk.ml
	type ..\builtin\builtin_*.ml >> _cTk.ml
	type _tkgen.ml >> _cTk.ml
	type << >> _cTk.ml


module Tkintf = struct
<<
	type ..\builtin\builtini_*.ml >> _cTk.ml
	type tkigen.ml >> _cTk.ml
	type << >> _cTk.ml
end (* module Tkintf *)


open Tkintf


<<
	type ..\builtin\builtinf_*.ml >> _cTk.ml
	type tkfgen.ml >> _cTk.ml
	..\..\..\boot\ocamlrun ..\compiler\pp < _cTk.ml > cTk.ml
	rm -f _cTk.ml
	$(CAMLDEP) -I ..\support ..\support\*.mli [a-z]*.mli [a-z]*.ml > .depend

clean:
	rm -f modules .depend
